<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.blog.search.dao.EsBlogDao">
    <resultMap id="esBlogListMap" type="com.blog.search.domain.EsBlog" autoMapping="true">
        <id column="id" jdbcType="BIGINT" property="id"/>
        <collection property="tags" columnPrefix="tag_"
                    ofType="com.blog.search.domain.EsBlogTag">
            <id column="id" property="id" jdbcType="BIGINT"/>
            <result column="blog_id" property="blogId" jdbcType="BIGINT"/>
            <result column="name" property="name"/>
        </collection>
    </resultMap>
    <select id="getAllEsBlogList" resultMap="esBlogListMap">
        select
        b.id id,
        b.appreciation ,
        b.commentabled ,
        b.title,
        b.description,
        b.first_picture firstPicture,
        b.content,
        b.create_time createTime,
        b.update_time updateTime,
        b.flag,
        b.flag_url flagUrl,
        b.recommend,
        b.share_statement shareStatement,
        b.state,
        b.ums_id umsId,
        t.id tag_id,
        t.blog_id tag_blog_id,
        t.`name` tag_name

        FROM bgms_blog b
        left join bgms_tag t on t.blog_id = b.id
        where b.state = 2
        <if test="id!=null">
            and b.id=#{id}
        </if>
    </select>
</mapper>